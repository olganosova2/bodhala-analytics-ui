<div>
  <div>
    <h4>Insights & Opportunities</h4>
  </div>

  <div style="display: inline; float: right;">
    <!-- add new functionality will be here (click)="generateQBR()"-->
    <!-- <button class="primary-button">Add New +</button> -->
    <button mat-button class="primary-button" [matMenuTriggerFor]="menu">Add New +</button>
    <mat-menu #menu="matMenu">
      <button mat-menu-item (click)="addRecommendation('Increase Discounts')">Increase Discounts</button>
      <button mat-menu-item (click)="addRecommendation('Prevent Rate Increases')">Prevent Rate Increases</button>
      <button mat-menu-item (click)="addRecommendation('Associate Work Allocation')">Associate Work Allocation</button>
      <button mat-menu-item (click)="addRecommendation('Partner Work Allocation')">Partner Work Allocation</button>
      <button mat-menu-item (click)="addRecommendation('Decrease Block Billing')">Decrease Block Billing</button>
      <button mat-menu-item (click)="addRecommendation('Shift Work to Other Firms')">Shift Work to Other Firms</button>
      <button mat-menu-item (click)="addRecommendation('Custom Recommendation')">Custom Recommendation</button>
    </mat-menu>
  </div>

  <p>You must select 3 of the following Insights to include in this report. You can choose any combination of Insights, including 3 of the same kind.<br>You can add new recommendations using the button to the right.</p>
  <div class="font-red" *ngIf="insightsForm.hasError('notEnoughSelected') || insightsForm.hasError('tooManySelected') ">
    You must select exactly 3 Insights to include in the report. Insights will not save if more than 3 are selected.
  </div>

  <form [formGroup]="insightsForm">
    <table *ngIf="recommendations && recommendationsProcessed == true">
      <tr>
        <th style="width: 60px;">Include</th>
        <th>Header</th>
        <th>Opportunity</th>
        <th>Why It Matters</th>
        <th>Notable Metrics</th>
        <th>Practice Area</th>
        <th>Firm</th>
      </tr>

      <tr *ngFor="let rec of recommendations">
        <td class="checkbox-td">
          <mat-checkbox formControlName="{{rec.sort_order + 'include'}}" (change)="checkboxClicked($event, rec)" [checked]="rec.included"></mat-checkbox>
        </td>
        <td (focusout)="saveInsight(rec)">
          <input formControlName="{{rec.sort_order + 'title'}}" pInputText class="form-control" type='text' value="{{rec.title}}" />
        </td>
        <td class="textinput-td" (focusout)="saveInsight(rec)">
          <textarea formControlName="{{rec.sort_order + 'opportunity'}}" matInput class="form-control" type='text' value="{{rec.opportunity}}" maxlength="400" rows="4" cols="40"></textarea>
        </td>
        <td class="textinput-td" (focusout)="saveInsight(rec)">
          <textarea formControlName="{{rec.sort_order + 'matters'}}" matInput class="form-control" value="{{rec.why_it_matters}}" maxlength="400" rows="4" cols="40"></textarea>
        </td>
        <td class="textinput-td" (focusout)="saveInsight(rec)">
          <textarea formControlName="{{rec.sort_order + 'metrics'}}" matInput class="form-control" type='text' value="{{rec.notable_metrics}}" maxlength="400" rows="4" cols="40"></textarea>
        </td>
        <td>
          <p-dropdown class="dropdown ml5" appendTo="body" [style]="{width:'140px'}" [options]="topPAs"
                    placeholder="Select PA to filter data" (onChange)="updateFirmDropdown($event, rec)" formControlName="{{rec.sort_order + 'practice_area'}}">
          </p-dropdown>
          <!-- (onChange)="typeChange($event)" -->
        </td>
        <td>
          <p-dropdown class="dropdown ml5" appendTo="body" [style]="{width:'140px'}" [options]="rec.currentFirmOptions"
                    placeholder="Select firm to filter data" (onChange)="updateFirmSelection($event, rec)" formControlName="{{rec.sort_order + 'firm'}}">
          </p-dropdown>
        </td>
      </tr>
    </table>
  </form>


</div>
