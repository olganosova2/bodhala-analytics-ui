<div>
  <div *ngIf="selectedTabIndex === 1">
    <lib-bd-filters
    (sendFilters)="refreshData($event)"
    [pageName]="pageName"
    [firmId]="firmId"
    [excludeFilters]="excludeFilters"
    [collapsed]="appStateService.layout.isCollapsed"
  ></lib-bd-filters>
  </div>
</div>
<mat-tab-group animationDuration="0ms" (selectedTabChange)="changeTab($event)" style="padding-top: 20px;">
  <mat-tab label="Report Card">
    <div class="rate-card-div" id="pdfDiv" #pdfDiv>
      <em class="icon-arrow-up"  *ngIf="showToTop" (click)="goToTop()"></em>
      <div>
        <div class="pull-left">
          <div class="p-grid">
            <div class="ui-3 pr20" *ngIf="logoUrl">
              <img [src]="logoUrl" alt="logo"/>
            </div>
            <div class="ui-9">
              <h2>{{commonServ.pageSubtitle}}</h2>
              <div class="font-bold">Timeframe: {{startdate}} - {{enddate}}</div>
              <div class="font-bold">Rank: <span *ngIf="rank>0">{{ rank }}</span><span *ngIf="rank<0"> > 20</span> ({{percentOfTotal * 100 | number:'1.2-2'}}% of total spend)</div>
              <div class="font-bold" *ngIf="selectedSavedFilterName!==null">Saved Filter: {{selectedSavedFilterName}}</div>
              <div class="font-bold" *ngIf="otherFirms"><i>Note: Rank and averages are based off firms available as defined by selected Timeframe and Filters.</i></div>
              <div class="font-bold" *ngIf="userService.hasEntitlement('analytics.practice.areas') && smartPAs === false">Note: Only the top Practice Area for {{commonServ.pageSubtitle}} is shown below Overall Spend</div>
              <div class="font-bold" *ngIf="userService.hasEntitlement('analytics.practice.areas') && smartPAs === true">Note: Only the top Smart Practice Area for {{commonServ.pageSubtitle}} is shown below Overall Spend</div>
            </div>
          </div>

        </div>
        <div class="pull-right">
          <lib-bd-annotations (notesUpdated)="loadNotes($event)" #annotations></lib-bd-annotations>
          <button #tooltip="matTooltip" matTooltip="Export this report card to PDF and automatically save for future viewing"  class="primary-button ml20" (click)="export()" [disabled]="commonServ.pdfLoading">Export & Save
            <img src="assets/images/Downloads.svg" width="25px" height="20px" alt="icon"/>
          </button>
          <button #tooltip="matTooltip" matTooltip="Edit filters for this report" class="primary-button ml20" (click)="editReportCard()">Edit</button>
          <button *ngIf="savedReports.length > 0" #tooltip="matTooltip" matTooltip="View saved reports for {{commonServ.pageSubtitle}}" class="primary-button ml20" (click)="showSavedReports()">Saved</button>
        </div>
      </div>

      <div class="clear-both"></div>
      <hr/>
      <div class="mb30 mt40">
        <h4 class="mb10"><span>Overall Spend</span></h4>
        <bd-report-card-billing-totals [firm]="firm" [isReportCard]="true" #billingTotals
                           *ngIf="firmId && firm"></bd-report-card-billing-totals>
        <bd-rate-card-tables [firmId]="firmId" [smartPAs]="smartPAs"></bd-rate-card-tables>
        <hr/>
      </div>
      <div *ngIf="userService.hasEntitlement('analytics.practice.areas')">
        <div *ngIf="practiceArea" class="mb30 mt40">
          <h4 class="mb10" ><span>{{practiceArea.practice_area}}</span></h4>
          <bd-report-card-billing-totals [firm]="firm" [smartPAs]="smartPAs" [isReportCard]="true" [practiceArea]="practiceArea.practice_area" #billingTotals
                              *ngIf="firmId && firm && practiceArea.practice_area"></bd-report-card-billing-totals>
          <bd-rate-card-tables *ngIf="firmId && firm && practiceArea.practice_area" [firmId]="firmId" [practiceArea]="practiceArea.practice_area" [smartPAs]="smartPAs"></bd-rate-card-tables>
          <hr *ngIf="firmId && firm && practiceArea.practice_area" id="hrEnd"/>
        </div>
      </div>
      <div [hidden]="!commonServ.pdfLoading">
        <h4>Annotations</h4>
        <div *ngFor="let note of notes">
            <bd-annotation-labels *ngIf="userService.hasEntitlement('ui.annotations')" [note]="note" [isPublicDefault]="false"></bd-annotation-labels>
            <div class="mt10" [innerHTML]="note.notes | safe: 'html'">></div>
          <hr/>
        </div>
      </div>

    </div>
  </mat-tab>

  <mat-tab label="Comparison">
    <div class="rate-card-div" id="comparisonDiv" #comparisonDiv>
      <div>
        <div class="pull-left">
          <div class="p-grid">
            <div class="ui-3 pr20" *ngIf="logoUrl">
              <img [src]="logoUrl" alt="logo"/>
            </div>
            <div class="ui-9">
              <h2>{{commonServ.pageSubtitle}}</h2>
              <div class="font-bold">Report Timeframe: {{startdate}} - {{enddate}}</div>
              <div class="font-bold">Comparison Timeframe: {{formattedComparisonStartDate}} - {{formattedComparisonEndDate}}</div>
            </div>
          </div>
        </div>
      </div>
      <div class="pull-right">
        <button class="primary-button ml20" (click)="export()" [disabled]="commonServ.pdfLoading" [ngClass]="{'button-disabled': commonServ.pdfLoading}">Export
          <img src="assets/images/Downloads.svg" width="25px" height="20px" alt="icon"/>
        </button>
      </div>

      <div class="clear-both"></div>
      <hr/>
      <bd-report-card-billing-totals [comparisonStartDate]="comparisonStartDate" [comparisonEndDate]="comparisonEndDate" [reportCardStartDate]="reportCardStartDate" [reportCardEndDate]="reportCardEndDate" [firm]="firm" [reportCard]="false" [isComparison]="true" #comparisonBillingTotals *ngIf="firmId && firm && selectedTabIndex === 1"></bd-report-card-billing-totals>
      <bd-spend-trend-chart *ngIf="selectedTabIndex === 1" [firmId]="firmId" [startdate]="startdate" [enddate]="enddate" [compStartDate]="comparisonStartDate" [compEndDate]="comparisonEndDate"></bd-spend-trend-chart>
    </div>
  </mat-tab>

</mat-tab-group>
